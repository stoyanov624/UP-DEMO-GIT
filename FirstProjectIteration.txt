SOME CODE FOR VERSION 2

Kaloyan added some code.